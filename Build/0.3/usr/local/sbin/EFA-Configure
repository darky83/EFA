#!/bin/bash
# +---------------------------------------------------+
# EFA-Reconfigure
# V0.1-20121115
# +---------------------------------------------------+

# +---------------------------------------------------+
# Option IP_SETTINGS
# +---------------------------------------------------+
opt_ip-settings(){
	func_getipsettings
	clear         
    echo "----------------- E.F.A -----------------"
    echo "-------------- IP SETTINGS --------------"
    echo " "
    echo "Current IP settings are:"
    echo "IP:		$CUR_IP"
	echo "Netmask:	$CUR_NM"
	echo "Gateway:	$CUR_GW"
	echo "Primary DNS:	$CUR_DNS1"
	echo "Secondary DNS:	$CUR_DNS2"
    pause
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Option HOSTNAME
# +---------------------------------------------------+
opt_hostname(){
	clear        
    echo "----------------- E.F.A -----------------"
    echo "---------------- HOSTNAME ---------------"
    echo ""
    pause
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Option Outbound mail relay
# +---------------------------------------------------+
opt_mailrelay(){
	clear        
    echo "----------------- E.F.A -----------------"
    echo "---------- OUTBOUND MAILRELAY -----------"
    echo " "
    echo "Description"
    echo "With this option you can configure E.F.A"
    echo "to relay outgoing message for your local"
    echo "mailserver or clients"
    pause
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Option Outbound Smarthost
# +---------------------------------------------------+
opt_smarthost(){
	clear      
    echo "----------------- E.F.A -----------------"
    echo "---------- OUTBOUND SMARTHOST -----------"
    echo " "
    echo "Description:"
    echo "With this option you can configure E.F.A"
    echo "to use a external smarthost for outgoing"
    echo "mail."
    pause
}
# +---------------------------------------------------+

# +---------------------------------------------------+

# +---------------------------------------------------+
# Option Outbound Smarthost
# +---------------------------------------------------+
opt_adminemail(){
	clear      
    echo "----------------- E.F.A -----------------"
    echo "---------- ADMIN EMAIL ADDRESS ----------"
    echo " "
    echo "Description:"
    echo "With this option you can change the E.F.A"
    pause
}
# +---------------------------------------------------+


# +---------------------------------------------------+
# Display menus
# +---------------------------------------------------+
show_menus() {
    clear       
    echo "----------------- E.F.A -----------------"
    echo "--------------- MAIN MENU ---------------"
    echo " " 
    echo "Please select the item you want to modify"
    echo " "
    echo "+- System settings:"
    echo "1. IP settings"
    echo "2. Hostname"
    echo ""
	echo "+- Mail related items:"
    echo "3. Outbound mail relay"
	echo "4. Outbound smarthost" 
	echo "5. Admin Email address"
    echo " "       
    echo "e. Exit"
}
# read input from the keyboard and take a action
read_options(){
    local choice
    read -p "Enter choice: " choice
    case $choice in
    	1) opt_ip-settings ;;
        2) opt_hostname ;;
        3) opt_mailrelay ;;
        4) opt_smarthost ;;
        5) opt_adminemail ;;
        e) exit 0;;
        *) echo -e "Error \"$choice\" is not an option..." && sleep 2
    esac
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Trap CTRL+C, CTRL+Z and quit singles
# +---------------------------------------------------+
trap '' SIGINT SIGQUIT SIGTSTP
# +---------------------------------------------------+

# +---------------------------------------------------+
# Pause
# +---------------------------------------------------+
pause(){
  read -p "Press [Enter] key to continue..." fackEnterKey
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Function to grabb the current IP settings.
# +---------------------------------------------------+
function func_getipsettings(){
	CUR_IP="`cat /etc/network/interfaces | grep address | awk {' print $2 '}`"
	CUR_NM="`cat /etc/network/interfaces | grep netmask | awk {' print $2 '}`"
	CUR_GW="`cat /etc/network/interfaces | grep gateway | awk {' print $2 '}`"
	CUR_DNS1="`awk 'NR==1 {print $2}' /etc/resolv.conf`"
	CUR_DNS2="`awk 'NR==2 {print $2}' /etc/resolv.conf`"
}
# +---------------------------------------------------+

# +---------------------------------------------------+
# Function to test IP addresses
# +---------------------------------------------------+
function checkip(){
  local  ip=$1
  local  stat=1

  if [[ $ip =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]; then
    OIFS=$IFS
    IFS='.'
    ip=($ip)
    IFS=$OIFS
    [[ ${ip[0]} -le 255 && ${ip[1]} -le 255 && ${ip[2]} -le 255 && ${ip[3]} -le 255 ]]
    stat=$?
  fi
  return $stat
}
# +---------------------------------------------------+


# +---------------------------------------------------+
# Main logic
# +---------------------------------------------------+
if [ `whoami` == root ]
    then
		while true
		do
        	show_menus
        	read_options
		done
  else
    echo "[EFA] ERROR: Please become root."
    exit 0
  fi
# +---------------------------------------------------+